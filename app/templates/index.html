<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC&display=swap&subset=chinese-traditional" rel="stylesheet">
  <title>å°åŒ—ä¸€æ—¥éŠ</title>
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
  <link rel="stylesheet" href="../static/style.css">
</head>
<body>
  <header class="desktop">
    <div class="navigation">
      <a href="/" class="left">
        <span class="title">å°åŒ—ä¸€æ—¥éŠ</span>
      </a>
      <div class="right">
        <a href="" class="menu-item">é å®šè¡Œç¨‹</a>
        <a href="" class="menu-item">ç™»å…¥/è¨»å†Š</a>
      </div>
    </div>
  </header>

  <section>
    <div class="welcome">
      <div class="text">
        <div class="slogan">
          <div class="title">è¼•é¬†äº«å—å°åŒ—ä¸€æ—¥æ‚ é–’</div>
          <div class="subtitle">æ¢ç´¢æ¯å€‹è§’è½ï¼Œé«”é©—åŸå¸‚çš„æ·±åº¦æ—…éŠè¡Œç¨‹</div>
        </div>
        <div class="search-bar">
          <input class="search-input" type="text" placeholder="è¼¸å…¥æ™¯é»åç¨±æŸ¥è©¢">
          <button class="search-btn" onclick="searchKeyword()">
            <img src="../static/search_icon.png" alt="">
          </button>
        </div>
      </div>
    </div>
  </section>

  <main>
    <div class="list-bar">
      <span class="left-container">
        <button class="left-arrow" onclick="moveLeft()"></button>
      </span>
        
      <span class="mid-container">
        <div class="mid-container-list"></div>
      </span>

      <span class="right-container">
        <button class="right-arrow", onclick="moveRight()"></button>
      </span>
    </div>

    <div class="attractions">
      <div class="attractions-group"></div>
    </div>

    <div class="footer">COPYRIGHT Â© 2021 å°åŒ—ä¸€æ—¥éŠ</div>
  </main>

  
  <script>
    const midContainerList = document.querySelector('.mid-container-list');
    const scrollAmount = 600; // èª¿æ•´æ»¾å‹•çš„è·é›¢

    const moveLeft = () => {
      midContainerList.scrollLeft -= scrollAmount;
    };

    const moveRight = () => {
      midContainerList.scrollLeft += scrollAmount;
    };

    const createAttration = (name, imgSrc, mrt, category) => {
      // å‰µå»º attration å…ƒç´ 
      const attration = document.createElement('div');
      attration.classList.add('attration');

      // å‰µå»º attration-img å…ƒç´ 
      const attrationImg = document.createElement('div');
      attrationImg.classList.add('attration-img');

      // å‰µå»º attration-file å…ƒç´ 
      const attrationFile = document.createElement('img');
      attrationFile.classList.add('attration-file');
      attrationFile.src = imgSrc;
      attrationFile.alt = '';
      attrationImg.appendChild(attrationFile);

      // å‰µå»º attration-name å…ƒç´ 
      const attrationName = document.createElement('div');
      attrationName.classList.add('attration-name');
      attrationName.textContent = name;
      attrationImg.appendChild(attrationName);

      // æ·»åŠ  attration-img åˆ° attration
      attration.appendChild(attrationImg);

      // å‰µå»º attration-details å…ƒç´ 
      const attrationDetails = document.createElement('div');
      attrationDetails.classList.add('attration-details');

      // å‰µå»º attration-info å…ƒç´ 
      const attrationInfo = document.createElement('div');
      attrationInfo.classList.add('attration-info');

      // å‰µå»ºå…©å€‹ div å…ƒç´ ä¸¦è¨­ç½®å…§å®¹
      const div1 = document.createElement('div');
      div1.textContent = mrt;
      attrationInfo.appendChild(div1);

      const div2 = document.createElement('div');
      div2.textContent = category;
      attrationInfo.appendChild(div2);

      // æ·»åŠ  attration-info åˆ° attration-details
      attrationDetails.appendChild(attrationInfo);

      // æ·»åŠ  attration-details åˆ° attration
      attration.appendChild(attrationDetails);

      // å°‡ attration æ·»åŠ åˆ° attractions-group
      const attractionsGroup = document.querySelector('.attractions-group');
      attractionsGroup.appendChild(attration);
    };

    const createMrt = (name) => {
        // å‰µå»º span å…ƒç´ 
        const span = document.createElement('span');
        span.classList.add('mid-container-list-listitem');
        span.textContent = name;
        span.addEventListener('click', () => {
          const input = document.querySelector('.search-input');
          input.value = name;
          const container = document.querySelector('.attractions-group');
          container.innerHTML = '';
          createAttractionsBySearchingName(name)
        });

        // å°‡ span å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­
        const container = document.querySelector('.mid-container-list');
        container.appendChild(span);
    };

    function searchKeyword() {
      // ç²å– search-input å…ƒç´ 
      const input = document.querySelector('.search-input');
      // ç²å– input çš„å€¼
      const keyword = input.value;
      const container = document.querySelector('.attractions-group');
      container.innerHTML = '';
      createAttractionsBySearchingName(keyword);
    }

    async function fetchhMrts() {
      const response = await fetch(`http://52.52.144.73:3000/api/mrts`);
      const data = await response.json();
      const dataList = data.data;
      for (let item of dataList) {
        createMrt(item);
      }
      return dataList;
    }

    async function createAttractionsBySearchingName(name) {
      const response = await fetch(`http://52.52.144.73:3000/api/attractions?keyword=${encodeURIComponent(name)}`);
      const data = await response.json();
      const dataList = data.data;
      for (let item of dataList) {
        createAttration(item.name, item.images[0], item.mrt, item.category)
      }
      if (dataList.length === 0) {
        const attractionsGroup = document.querySelector('.attractions-group');
        const h2 = document.createElement('h2');
        h2.textContent = 'æœå°‹çš„é—œéµå­—æ‰¾ä¸åˆ°ä»»ä½•è³‡æ–™ğŸ¥º';
        attractionsGroup.appendChild(h2);
      }
      return dataList;
    }

    async function createAttractionsByPage(page) {
      const response = await fetch(`http://52.52.144.73:3000/api/attractions?page=${page}`);
      const data = await response.json();
      const dataList = data.data;
      for (let item of dataList) {
        createAttration(item.name, item.images[0], item.mrt, item.category)
      }
      return data;
    }

    let nextPage = 0;
    let timer = null;

    function handleIntersection(entries) {
      if (entries[0].isIntersecting) {
        if (timer) {
          clearTimeout(timer);
        }
        
        timer = setTimeout(() => {
          createAttractionsByPage(nextPage)
            .then(data => {
              nextPage = data.nextPage;
            })
            .catch(error => {
              console.error('Error:', error);
            });
          timer = null;
        }, 200);
      }
    }
    const observer = new IntersectionObserver(handleIntersection);
    const target = document.querySelector('.footer');
    observer.observe(target);

    fetchhMrts();

  </script>
</body>



</html>
